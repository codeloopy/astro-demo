---
import MainLayout from '../../layouts/main.astro'
import Article from '../../components/article.astro'
import SearchForm from '../../components/search_form.astro'

import { getCollection } from 'astro:content'
import type { CollectionEntry } from 'astro:content'

const query: string|null = Astro.url.searchParams.get('query'); // Get the search query from the URL, whihc aldo is from the name of the input in the form

const allArticles: CollectionEntry<'blog'>[] = await getCollection('blog');
console.log("Search Query: ", query)

// filter articles based on query
const searchResults = allArticles.filter(article => {
  const titleMatch: boolean = article.data.title?.toLowerCase().includes(query!.toLowerCase());
  const bodyMatch: boolean = article.body?.toLowerCase().includes(query!.toLowerCase());
  const slugMatch: boolean = article.slug?.toLowerCase().includes(query!.toLowerCase());
  console.log("Title Match: ", titleMatch, "Body Match: ", bodyMatch, "Slug Match: ", slugMatch)
  return titleMatch || bodyMatch || slugMatch;
})

console.log("Search Results: ", searchResults)
---
<MainLayout>
  <div class="max-w-3xl mx-auto px-4">
    <h1 class="text-4xl font-bold text-center my-10">Search Results for {query}</h1>
    <SearchForm />
  </div>
  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
    {searchResults.length > 0 ? (
      searchResults.map((article) => (
        <Article article={article} />
      ))
    ) : (
      <p class="text-center col-span-full">No articles found.</p>
    )}

  </div>
  <div class="mt-6 flex justify-center">
    <a href={`/`} class="inline-block bg-gray-100 p-2 hover:bg-indigo-500 hover:text-white">Back To Articles</a>
  </div>
</MainLayout>
